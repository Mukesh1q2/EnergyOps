# OptiBid Energy: Production Kubernetes Infrastructure
# Namespace and Resource Management

apiVersion: v1
kind: Namespace
metadata:
  name: optibid
  labels:
    name: optibid
    environment: production
    app: optibid-energy

---
# Resource Quotas for Production
apiVersion: v1
kind: ResourceQuota
metadata:
  name: optibid-quota
  namespace: optibid
spec:
  hard:
    requests.cpu: "50"
    requests.memory: 100Gi
    limits.cpu: "100"
    limits.memory: 200Gi
    persistentvolumeclaims: "20"
    pods: "50"
    services: "20"

---
# Limit Ranges for Resource Management
apiVersion: v1
kind: LimitRange
metadata:
  name: optibid-limits
  namespace: optibid
spec:
  limits:
  - default:
      cpu: "2"
      memory: 4Gi
    defaultRequest:
      cpu: "500m"
      memory: 1Gi
    type: Container
  - max:
      cpu: "8"
      memory: 16Gi
    min:
      cpu: "200m"
      memory: 256Mi
    type: Container

---
# Network Policy for Security
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: optibid-network-policy
  namespace: optibid
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: optibid
    - podSelector: {}
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    - namespaceSelector:
        matchLabels:
          name: kube-prometheus
    ports:
    - protocol: TCP
      port: 53
    - protocol: UDP
      port: 53

---
# Horizontal Pod Autoscaler for Frontend
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: optibid-frontend-hpa
  namespace: optibid
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: optibid-frontend
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80

---
# Horizontal Pod Autoscaler for Backend
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: optibid-backend-hpa
  namespace: optibid
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: optibid-backend
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80

---
# Priority Classes for Resource Management
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: optibid-system-priority
value: 1000
globalDefault: false
description: "Priority class for critical system components"

---
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: optibid-app-priority
value: 900
globalDefault: false
description: "Priority class for application workloads"

---
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: optibid-background-priority
value: 800
globalDefault: false
description: "Priority class for background jobs and batch processing"